<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deterministic Causal Engine V3.3 - Predictive Phase</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .gold-gradient { background: linear-gradient(135deg, #ffd700, #b8860b); color: white; }
        .logic-card { border-left: 5px solid #3b82f6; }
        .veto-alert { border-left: 5px solid #ef4444; background-color: #fef2f2; }
        .pure-logic-set { border-left: 5px solid #10b981; background-color: #ecfdf5; }
    </style>
</head>
<body class="bg-gray-100 min-h-screen p-4">

    <div class="max-w-4xl mx-auto space-y-6">
        <header class="bg-white p-6 rounded-2xl shadow-sm text-center">
            <h1 class="text-2xl font-bold text-gray-800">Causal Engine V3.3</h1>
            <p class="text-gray-500 text-sm">Predictive Mode: Pure Logic + Social Integration</p>
        </header>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div class="bg-white p-4 rounded-xl shadow-sm">
                <label class="block text-sm font-medium text-gray-700">Gist URL (Raw)</label>
                <input type="text" id="gistUrl" placeholder="https://gist.githubusercontent.com/..." class="w-full mt-1 p-2 border rounded-lg text-sm">
                <button onclick="syncData()" class="mt-3 w-full bg-blue-600 text-white py-2 rounded-lg font-semibold hover:bg-blue-700 transition">DATABASE SYNC</button>
            </div>
            <div id="statusPanel" class="bg-white p-4 rounded-xl shadow-sm flex items-center justify-center text-center">
                <p class="text-gray-400">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏û‡∏¢‡∏≤‡∏Å‡∏£‡∏ì‡πå</p>
            </div>
        </div>

        <div id="predictionDisplay" class="hidden space-y-6">
            
            <div class="bg-white p-6 rounded-2xl shadow-md pure-logic-set">
                <h2 class="text-lg font-bold text-green-800 flex items-center">
                    <span>üõ°Ô∏è Pure Logic Synthesis (Base Set)</span>
                </h2>
                <p class="text-xs text-green-600 mb-4">*‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏≤‡∏Å‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡πÅ‡∏•‡∏∞‡∏î‡∏ß‡∏á‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå ‡∏•‡πâ‡∏ß‡∏ô‡πÜ (‡πÑ‡∏°‡πà‡∏á‡πâ‡∏≠ Social)</p>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4" id="pureLogicResult">
                    </div>
            </div>

            <div class="bg-white p-6 rounded-2xl shadow-md logic-card">
                <h2 class="text-lg font-bold text-blue-800 mb-4">üîÆ Social Convergence Analysis</h2>
                <div id="socialResult" class="space-y-4">
                    </div>
            </div>

            <div id="vetoPanel" class="hidden p-4 rounded-xl veto-alert">
                <p id="vetoMessage" class="text-red-700 font-medium"></p>
            </div>
        </div>
    </div>

    <script>
        let engineData = null;

        async function syncData() {
            const url = document.getElementById('gistUrl').value;
            if(!url) return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà Gist URL');
            
            try {
                const response = await fetch(url);
                engineData = await response.json();
                document.getElementById('statusPanel').innerHTML = `<p class="text-green-600 font-bold">‚úì Data Synced: ${engineData.draws[0].date}</p>`;
                runAnalysis();
            } catch (e) {
                alert('‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö URL');
            }
        }

        function runAnalysis() {
            const current = engineData.draws[0];
            const temp = parseInt(current.recommendedTemp);
            const isTempEven = temp % 2 === 0;
            const lunar = current.lunarPhase;
            const socialInputs = current.suggestedSocial.split(',').map(s => s.trim());

            // 1. Calculate Top Digits (Pure Logic)
            let digits = [0,1,2,3,4,5,6,7,8,9].map(d => {
                let score = 0;
                if(isTempEven && d % 2 === 0) score += 5;
                if(!isTempEven && d % 2 !== 0) score += 5;
                if(lunar === "Waxing Moon" && d >= 5) score += 3;
                if(lunar === "Waning Moon" && d < 5) score += 3;
                return { digit: d, score: score };
            }).sort((a,b) => b.score - a.score);

            const top4 = digits.slice(0, 4).map(d => d.digit);

            // 2. Generate Pure Logic Numbers (New in V3.3)
            renderPureLogic(top4);

            // 3. Social Integration & Veto Logic
            renderSocialConvergence(socialInputs, top4, isTempEven);

            document.getElementById('predictionDisplay').classList.remove('hidden');
        }

        function renderPureLogic(top4) {
            const container = document.getElementById('pureLogicResult');
            // Generate 2-Digit Pairs
            let pairs = [
                `${top4[0]}${top4[1]}`,
                `${top4[0]}${top4[2]}`,
                `${top4[1]}${top4[3]}`
            ];
            
            container.innerHTML = pairs.map(p => `
                <div class="bg-white border-2 border-green-200 p-3 rounded-lg text-center">
                    <span class="text-xs block text-gray-400 font-bold uppercase">Pure 2D</span>
                    <span class="text-2xl font-black text-green-700">${p}</span>
                </div>
            `).join('') + `
                <div class="bg-green-600 p-3 rounded-lg text-center text-white">
                    <span class="text-xs block text-green-200 font-bold">TOP DIGIT</span>
                    <span class="text-2xl font-black">${top4[0]}</span>
                </div>
            `;
        }

        function renderSocialConvergence(socials, top4, isTempEven) {
            const container = document.getElementById('socialResult');
            const vetoPanel = document.getElementById('vetoPanel');
            let vetoTriggers = [];

            let html = socials.map(s => {
                let confidence = 50;
                let reasons = [];
                
                // Check against Top Digits
                let matchCount = 0;
                top4.forEach(d => { if(s.includes(d.toString())) matchCount++; });
                
                confidence += (matchCount * 15);
                if(matchCount > 0) reasons.push(`${matchCount} Digits Match Logic`);

                // Veto Check: If Social number is completely against Temp Parity
                let isSocialEven = parseInt(s) % 2 === 0;
                if(s.length === 2 && isSocialEven !== isTempEven) {
                    confidence -= 30;
                    vetoTriggers.push(`‡∏£‡∏∞‡∏ß‡∏±‡∏á: ‡πÄ‡∏•‡∏Ç ${s} ‡∏Ç‡∏±‡∏î‡πÅ‡∏¢‡πâ‡∏á‡∏Å‡∏±‡∏ö‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥ (${isTempEven ? '‡∏Ñ‡∏π‡πà' : '‡∏Ñ‡∏µ‡πà'})`);
                }

                const bgColor = confidence >= 80 ? 'gold-gradient' : 'bg-gray-50';

                return `
                    <div class="${bgColor} p-4 rounded-xl border flex justify-between items-center shadow-sm">
                        <div>
                            <span class="text-2xl font-black">${s}</span>
                            <p class="text-xs opacity-80">${reasons.join(' | ')}</p>
                        </div>
                        <div class="text-right">
                            <span class="text-sm font-bold">Confidence</span>
                            <div class="text-xl font-black">${Math.min(confidence, 99)}%</div>
                        </div>
                    </div>
                `;
            }).join('');

            container.innerHTML = html;

            if(vetoTriggers.length > 0) {
                vetoPanel.classList.remove('hidden');
                document.getElementById('vetoMessage').innerText = vetoTriggers[0];
            } else {
                vetoPanel.classList.add('hidden');
            }
        }
    </script>
</body>
</html>
